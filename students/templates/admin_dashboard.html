{% extends 'base.html' %}
{% block title %}Principal Dashboard{% endblock %}

{% block content %}

<div class="container mt-4">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold">Principal Dashboard</h2>

    <div class="d-flex gap-2">
      <a href="{% url 'add_student' %}" class="btn btn-primary btn-sm">Add Student</a>
      <a href="{% url 'add_teacher' %}" class="btn btn-outline-primary btn-sm">Add Teacher</a>
    </div>
  </div>

  <!-- Departments -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-light fw-semibold">
      Departments
    </div>
    <div class="card-body">

      {% if departments %}
        <ul class="list-group">
          {% for d in departments %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <strong>{{ d.name }}</strong>
              </div>
              <div class="btn-group btn-group-sm">
                <a href="{% url 'view_timetable' d.id %}" class="btn btn-outline-secondary">View Timetable</a>
              </div>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-muted">No departments. Add one in admin panel.</p>
      {% endif %}

    </div>
  </div>

  <!-- Teachers -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-light fw-semibold">
      Teachers
    </div>
    <div class="card-body p-0">

      <div class="table-responsive">
        <table class="table table-striped table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th>Username</th>
              <th>Name</th>
              <th>Department</th>
            </tr>
          </thead>
          <tbody>
            {% for t in teachers %}
              <tr>
                <td>{{ t.user.username }}</td>
                <td>{{ t.user.get_full_name }}</td>
                <td>{{ t.department }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

    </div>
  </div>

  <!-- Students -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-light fw-semibold">
      Students
    </div>
    <div class="card-body p-0">

      <div class="table-responsive">
        <table class="table table-striped table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>Username</th>
              <th>Name</th>
              <th>Department</th>
              <th>Image</th>
            </tr>
          </thead>
          <tbody>
            {% for s in students %}
              <tr>
                <td>{{ s.user.username }}</td>
                <td>{{ s.user.get_full_name }}</td>
                <td>{{ s.department }}</td>
                <td>
                  {% if s.image %}
                    <img src="{{ s.image.url }}" class="img-thumbnail" width="60" height="60" style="object-fit: cover;">
                  {% else %}
                    <span class="text-muted">No photo</span>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

    </div>
  </div>

  <!-- Attendance Summary -->
  <div class="card shadow-sm">
    <div class="card-header bg-light fw-semibold">
      Today's Attendance Summary ({{ today }})
    </div>
    <div class="card-body">

      {% if attendance_today %}
        <ul class="list-group">
          {% for dept, stats in attendance_today.items %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <strong>{{ dept }}</strong>
              <span class="badge bg-primary rounded-pill">
                {{ stats.present }} / {{ stats.total }}
              </span>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-muted">No attendance data for today.</p>
      {% endif %}

    </div>
  </div>

</div>

{% endblock %}
